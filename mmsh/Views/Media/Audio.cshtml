@{
    ViewBag.Title = "mmsh | Медиа > Аудио";
}
@section additional
{
    <script type="text/javascript">
        function getAudio() {
            var params = {
                'type': 'audio'
            };
            var d = { par: params };
            $.ajax({
                type: "POST",
                url: "/helper.svc/getlist",
                data: $.toJSON(d),
                async: false,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (msg) {
                    var data = msg.d;
                    //console.log(data);
                    var pl = $('#playlist');
                    var i = 0;
                    for (_t in data) {
                        var t = data[_t];
                        var ac = $('<div class="a-c" />').appendTo(pl);
                        var at = $('<div class="a-t" />').appendTo(ac);
                        var aa = $('<div class="a-a" />').appendTo(ac);
                        ac.data({ path: t.path })
							.attr({ id: 'track' + i })
							.click(function () {
							    if (!$('#audio' + i).length) {
							        $('<audio />').appendTo('#track' + i)
							            .attr({
							                id: 'audio' + i,
							                src: '/helper.svc/stream?uname=' + encodeURI(t.path),
							                controls: true
							            });
							    } else {
							        $('#audio' + i).remove();
							    }
							});
                        aa.text(t.artist || "VA");
                        at.text(t.title || "Untitled");
                        i++;
                    }
                    /*var ul = $('<ul />').appendTo(pl);
                    var i = 0;
                    for (_t in data) {
                        var t = data[_t];
                        var li = $('<li />').appendTo(ul);
                        $('<a />').appendTo(li)
							.text((t.artist || "VA") + " - " + t.title)
							.data({ path: t.path })
							.attr({ id: 'track' + i })
							.click(function () {
							    $('audio' + i).pause();
							});
                        $('<audio />').appendTo(li)
							.attr({
							    id: 'audio' + i,
							    src: '/helper.svc/stream?uname=' + encodeURI(t.path),
							    controls: true
							});
                    }*/
                }
            });
        }
        function test() {
            var params = {
                'type': 'audio'
            };
            var d = { par: $.toJSON(params) };
            $.ajax({
                type: "GET",
                url: "/helper.svc/getlist",
                data: d,
                async: true,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                success: function (msg) {
                    console.log(msg);
                }
            });
        }
        $(function () {
            getAudio();
        });
    </script>
}
<h3>@ViewBag.Message</h3>

<div class="row">
    <div class="col-md-9" id="playlist">&nbsp;</div>
    <div class="col-md-3" id="info">
        <!--<button type="button" class="btn btn-default" onclick="getAudio();"><span class="glyphicon glyphicon-refresh"></span></button>-->
        <!--<div class="a-c">
            <div class="a-t">
                <h1>Title</h1>
            </div>
            <div class="a-a">
                <h2>Artist</h2>
            </div>
        </div>-->
    </div>
</div>